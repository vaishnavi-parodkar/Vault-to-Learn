<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Page</title>
  <link rel="stylesheet" href="/CSS/loginpage.css"/>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">Vault to Learn</div>
      <ul class="nav-links">
        <li><a href="homepage.html">Home</a></li>
        <li><a href="homepage.html">Features</a></li>
        <li><a href="homepage.html">About</a></li>
        <li><a href="homepage.html">Contact</a></li>
        <li><a href="#login" class="btn-login">Login/Sign-up</a></li>
      </ul>
    </nav>
  </header>

  <!-- LOGIN FORM -->
  <div class="container" id="login-form">
    <p class="login-title">Login</p>

    <div class="emaildress">
      <p class="text-email">Email Address</p>
      <input id="login-email" placeholder="Enter your Email" class="box">
    </div>
    <p id="login-email-error" class="error"></p>

    <div class="password">
      <p class="text-pass">Password</p>
      <input id="login-password" type="password" placeholder="Enter password" class="box">
    </div>
    <p id="login-password-error" class="error"></p>

    <button onclick="loginUser()" class="login-btn">Login</button>
    <p id="login-status"></p>

    <p class="no-account">Don't have an account?</p>
    <button onclick="showSignupForm()" class="signup-btn">Sign up</button>
  </div>

  <!-- SIGNUP FORM -->
  <div class="container" id="signup-form" style="display: none;">
    <p class="login-title">Sign Up</p>

    <div class="name">
      <p class="text-name">Name</p>
      <input id="signup-name" placeholder="Enter your Name" class="box">
    </div>

    <div class="emaildress">
      <p class="text-email">Email Address</p>
      <input id="signup-email" placeholder="Enter your Email" class="box">
    </div>
    <p id="signup-email-error" class="error"></p>

    <div class="password">
      <p class="text-pass">Password</p>
      <input id="signup-password" type="password" placeholder="Enter password" class="box">
    </div>
    <p id="signup-password-error" class="error"></p>

    <button onclick="signupUser()" class="signup-btn">Create Account</button>
    <p id="signup-status"></p>

    <p class="have-account">Already have an account?</p>
    <button onclick="showLoginForm()" class="login-btn">Back to Login</button>
  </div>

  <script>
    // Show the Signup Form
    function showSignupForm() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('signup-form').style.display = 'block';
    }

    // Show the Login Form
    function showLoginForm() {
      document.getElementById('signup-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'block';
    }

    // Validate login
    function loginUser() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      let isValid = true;

      // Reset error messages
      document.getElementById('login-email-error').innerHTML = '';
      document.getElementById('login-password-error').innerHTML = '';

      if (!email) {
        document.getElementById('login-email-error').innerHTML = "Please enter your email.";
        isValid = false;
      }
      if (!password) {
        document.getElementById('login-password-error').innerHTML = "Please enter your password.";
        isValid = false;
      }

      if (isValid) {
        fetch('http://localhost:3000/api/auth/login', {  // Update port to 5000
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        })
        .then(response => response.json())
        .then(data => {console.log(data);
         
          if (data) {
            document.getElementById('login-status').innerHTML = 'Logged in successfully!';
            window.location.href = 'notespage.html';
          } else {
            document.getElementById('login-status').innerHTML = 'Invalid credentials!';
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('login-status').innerHTML = 'Login failed. Please try again.';
        });
      }
    }

    // Validate signup
    function signupUser() {
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      let isValid = true;

      // Reset error messages
      document.getElementById('signup-email-error').innerHTML = '';
      document.getElementById('signup-password-error').innerHTML = '';

      if (!email) {
        document.getElementById('signup-email-error').innerHTML = "Please enter your email.";
        isValid = false;
      }
      if (!password) {
        document.getElementById('signup-password-error').innerHTML = "Please enter your password.";
        isValid = false;
      }

      if (isValid) {
        fetch('http://localhost:3000/api/auth/signup', {  // Update port to 5000
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({name , email, password })
        })
        .then(response => response.text())
        
        .then(data => {
          if (data.success) {
            document.getElementById('signup-status').innerHTML = "Account created successfully! Please log in.";
            setTimeout(signupUser, 1000);

          } else {
            document.getElementById('signup-status').innerHTML = "Signup failed: " + data.message;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          document.getElementById('signup-status').innerHTML = 'Signup failed. Please try again.';
        });
      }
    }
  </script>
</body>
</html>
